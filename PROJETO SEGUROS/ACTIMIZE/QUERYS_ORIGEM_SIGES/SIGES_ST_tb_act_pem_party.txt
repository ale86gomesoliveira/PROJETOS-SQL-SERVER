WITH MAX_DATA AS
(SELECT 
	CD_CONTROLE, 
	MAX(DT_ENVIO) AS DT_ENVIO 
	FROM DBTCTO.TB_PEM_LISTA_PESSOA TPL
	GROUP BY CD_CONTROLE
	ORDER BY 1 DESC)
SELECT
DISTINCT
TRIM(TPL.TP_LISTA) AS List_type_tx,
CASE 
	WHEN CD_RELACAO = '1' THEN 'FUNCIONÁRIO'
	WHEN CD_RELACAO = '2'  THEN 'CLIENTE'
	WHEN CD_RELACAO = '3'  THEN 'FRANQUEADO'
	WHEN CD_RELACAO = '4'  THEN 'PRESTADOR'
	WHEN CD_RELACAO = '5'  THEN 'CANDI FRANQUE'
	WHEN CD_RELACAO = '6'  THEN 'CANDI FUNCIO'	
	WHEN CD_RELACAO = '7'  THEN 'EVENTUAL'
	WHEN CD_RELACAO = '8'  THEN 'SÓCIO FRANQUEADO'
	WHEN CD_RELACAO = '9'  THEN 'PRESTADOR KYOEI'
	WHEN CD_RELACAO = '10' THEN 'CLIENTE KYOEI'
	WHEN CD_RELACAO = '11' THEN 'FUNCIONARIO KYOEI'
	WHEN CD_RELACAO = '12' THEN 'CLIENTE VG'
	WHEN CD_RELACAO = '13' THEN 'CORRETOR VG'
	WHEN CD_RELACAO = '14' THEN 'PRESTADOR VG'
	WHEN CD_RELACAO = '15' THEN 'FAVORECIDO'
	WHEN CD_RELACAO = '16' THEN 'SEGURADO VG'
	WHEN CD_RELACAO = '17' THEN 'BENEFICIARIO VG'
	WHEN CD_RELACAO = '18' THEN 'SUBESTIPULANTE VG'
	WHEN CD_RELACAO = '19' THEN 'POTENCIAL CLIENTE'
	WHEN CD_RELACAO = '20' THEN 'teste'
	WHEN CD_RELACAO = '21' THEN 'Teste'
	WHEN CD_RELACAO = '22' THEN 'FAVORE MASSIFICA'
END Relationship_tx,
trim(TPL.CD_CONTROLE CONCAT CD_VERIFICADOR) AS Control_Id,
trim(CD_FILIAL) AS Branch_Cd,
CD_VERIFICADOR AS Verification_Cd,
TRIM(TPL.DS_NOME) AS Person_Company_Nm, 
trim(TPL.DS_COMENTARIO) AS Comments_Tx,
CAST(TPL.DT_INCLUSAO AS date) AS Insert_Date_Dt,
TPL.ORIGEM AS Origin_Tx,
trim(TPL.SITUACAO) AS Status_Tx,
CAST(TPL.DT_ENVIO AS timestamp) Send_Date_Dh,
CAST(TPL.DT_NOTIFICACAO AS timestamp) AS Notification_Date_Dh,
TPL.ST_NOTIFICACAO AS Notification_Status_Tx
FROM DBTCTO.TB_PEM_LISTA_PESSOA TPL
INNER JOIN MAX_DATA ME ON ME.DT_ENVIO = TPL.DT_ENVIO