WITH max_dt_log 
AS
(SELECT 
CD_CONTROLE,
 max(DT_LOG) AS DATA_LOG
 FROM DBTCTO.TB_PEP_CONSULTAS tp --WHERE cd_controle IN ('063020728','010328523')
 GROUP BY CD_CONTROLE
 ORDER BY 1 DESC
)
SELECT
DISTINCT
TRIM(tpc.CD_CONTROLE CONCAT CD_VERIFICADOR) AS Control_Id,
TRIM(CD_FILIAL) AS Branch_Cd,
CD_VERIFICADOR AS Verification_Cd,
DT_SISTEMA AS System_Date_Dt,
CASE 
	WHEN CD_RELACAO = '1' THEN 'FUNCIONÁRIO'
	WHEN CD_RELACAO = '2'  THEN 'CLIENTE'
	WHEN CD_RELACAO = '3'  THEN 'FRANQUEADO'
	WHEN CD_RELACAO = '4'  THEN 'PRESTADOR'
	WHEN CD_RELACAO = '5'  THEN 'CANDI FRANQUE'
	WHEN CD_RELACAO = '6'  THEN 'CANDI FUNCIO'	
	WHEN CD_RELACAO = '7'  THEN 'EVENTUAL'
	WHEN CD_RELACAO = '8'  THEN 'SÓCIO FRANQUEADO'
	WHEN CD_RELACAO = '9'  THEN 'PRESTADOR KYOEI'
	WHEN CD_RELACAO = '10' THEN 'CLIENTE KYOEI'
	WHEN CD_RELACAO = '11' THEN 'FUNCIONARIO KYOEI'
	WHEN CD_RELACAO = '12' THEN 'CLIENTE VG'
	WHEN CD_RELACAO = '13' THEN 'CORRETOR VG'
	WHEN CD_RELACAO = '14' THEN 'PRESTADOR VG'
	WHEN CD_RELACAO = '15' THEN 'FAVORECIDO'
	WHEN CD_RELACAO = '16' THEN 'SEGURADO VG'
	WHEN CD_RELACAO = '17' THEN 'BENEFICIARIO VG'
	WHEN CD_RELACAO = '18' THEN 'SUBESTIPULANTE VG'
	WHEN CD_RELACAO = '19' THEN 'POTENCIAL CLIENTE'
	WHEN CD_RELACAO = '20' THEN 'teste'
	WHEN CD_RELACAO = '21' THEN 'Teste'
	WHEN CD_RELACAO = '22' THEN 'FAVORE MASSIFICA'
END Relationship_tx,
DT_SERASA AS Serasa_Date_Dt,
TRIM(TP_CONSULTA) AS query_type_tx,
TRIM(USUARIO) AS User_Name_Nm,
CAST(dt_log AS DATE) AS Log_Date_Dh,
TRIM(ST_PEP) AS PEP_Status_Tx,
FL_PEP AS PEP_Flag_Tx,
DT_ABERTURA_SERASA AS Serasa_opening_Date_Dt
	FROM DBTCTO.TB_PEP_CONSULTAS tpc
	INNER JOIN max_dt_log mdt ON tpc.dt_log = MDT.DATA_Log
	WHERE TPC.cd_controle IN ('063020728','010328523')