
Select distinct 
sub.Id_sub as Party_Key_Id ,
convert(date,getdate()) as Birth_Incorp_Dt ,
sub.Nm_descricao_sub as First_Name_Nm ,
'' as Middle_Name_Nm ,
sub.Nm_descricao_sub as Last_Name_Nm ,
'' as Maiden_Name_Nm ,
s.nm_sexo as Gender_Cd ,
'' as Is_Active_Nm ,
convert(date,getdate()) as Is_Active_Dt ,
'' as Is_To_Be_Deleted_Nm ,
'' as Party_Classification_Cd ,
tpp.cd_tipo_pessoa as Party_Type_Cd ,
ltrim(rtrim(P.nm_pessoa)) as Party_Name_Nm ,
'BRA' as Tenant_Cd ,
'0' as Partitioning_Key_Id ,
'' as Party_Alias_Key1_Id ,
'' as Party_Alias_First_Name1_Nm ,
'' as Party_Alias_Middle_Name1_Nm ,
'' as Party_Alias_Last_Name1_Nm ,
'' as Party_Alias_Maiden_Name1_Nm ,
'' as Party_Alias_Key2_Nm ,
'' as Party_Alias_First_Name2_Nm ,
'' as Party_Alias_Middle_Name2_Nm ,
'' as Party_Alias_Last_Name2_Nm ,
'' as Party_Alias_Maiden_Name2_Nm ,
'' as Party_Alias_Key3_Id ,
'' as Party_Alias_First_Name3_Nm ,
'' as Party_Alias_Middle_Name3_Nm ,
'' as Party_Alias_Last_Name3_Nm ,
'' as Party_Alias_Maiden_Name3_Nm ,
'' as Document_Key1_Id ,
'' as Document_Number1_Nr ,
'' as Document_Type1_Cd ,
'' as Issue_Country1_Cd ,
'' as Issue_State_Province1_Cd ,
'' as Document_Key2_Id ,
'' as Document_Number2_Nr ,
'' as Document_Type2_Cd ,
'' as Issue_Country2_Cd ,
'' as Issue_State_Province2_Cd ,
'' as Document_Key3_Id ,
'' as Document_Number3_Nr ,
'' as Document_Type3_Cd ,
'' as Issue_Country3_Cd ,
'' as Issue_State_Province3_Cd ,
'' as Document_Key4_Id ,
'' as Document_Number4_Nr ,
'' as Document_Type4_Cd ,
'' as Issue_Country4_Cd ,
'' as Issue_State_Province4_Cd ,
'Group Life Account Owner or Stipulator' as Primary_Party_Business_Unit_Cd ,
'' as Business_Unit1_Cd ,
'' as Business_Unit2_Cd ,
'' as Business_Unit3_Cd ,
'' as Party_Reference_Id ,
'' as Email_Relation_Type1_Cd ,
'' as Party_Email_Address1_Nm ,
'' as Email_Relation_Type2_Cd ,
'' as Party_Email_Address2_Nm ,
'' as Phone_Relation_Type1_Cd ,
'' as Party_Phone1_Nr ,
'' as Phone_Relation_Type2_Cd ,
'' as Party_Phone2_Nr ,
'' as Phone_Relation_Type3_Cd ,
'' as Party_Phone3_Nr ,
e.id_tp_endereco as Address_Relation_Type1_Cd ,
'' as Address_Line_1_Nm ,
'' as Address_Line_2_Nm ,
'' as Address_Line_3_Nm ,
'' as Address_Line_4_Nm ,
'' as Address_Line_5_Nm ,
'' as Apartment_Suite_Number1_Nr ,
'' as Building_Number1_Nr ,
'Sao Paulo' as City1_Nm ,
'BRA' as Address_Country1_Cd ,
'' as Po_Box1_Nm ,
'' as State_Province1_Cd ,
'' as Street1_Nm ,
e.nm_cep as Zip_Postcode1_Cd ,
'' as Address_Relation_Type2_Cd ,
'' as Address2_Line_1_Nm ,
'' as Address2_Line_2_Nm ,
'' as Address2_Line_3_Nm ,
'' as Address2_Line_4_Nm ,
'' as Address2_Line_5_Nm ,
'' as Apartment_Suite_Number2_Nr ,
'' as Building_Number2_Nr ,
'' as City2_Nm ,
'BRA' as Address_Country2_Cd ,
'' as Po_Box2_Nm ,
'' as State_Province2_Cd ,
'' as Street2_Nm ,
'' as Zip_Postcode2_Cd ,
'' as Address_Relation_Type3_Cd ,
'' as Address3_Line_1_Nm ,
'' as Address3_Line_2_Nm ,
'' as Address3_Line_3_Nm ,
'' as Address3_Line_4_Nm ,
'' as Address3_Line_5_Nm ,
'' as Apartment_Suite_Number3_Nr ,
'' as Building_Number3_Nr ,
'' as City3_Nm ,
'BRA' as Address_Country3_Cd ,
'' as Po_Box3_Nm ,
'' as State_Province3_Cd ,
'' as Street3_Nm ,
'' as Zip_Postcode3_Cd ,
'BRA' as Country_Relation_Type1_Nm ,
'BRA' as Country_Relation1_Cd ,
'BRA' as Country_Relation_Type2_Nm ,
'BRA' as Country_Relation2_Cd ,
'BRA' as Country_Relation_Type3_Nm ,
'BRA' as Country_Relation3_Cd ,
'' as Is_Foreign_Financial_Org_Nm ,
'' as Is_Foreign_Official_Nm ,
'' as Is_Nbfi_Ds ,
'' as Is_Non_Resident_Ds,
'' as Is_Pep_Ds ,
convert(date,getdate()) as Last_Review_Dt ,
'' as Number_Of_Sars_Nr ,
'' as Number_Of_Subpoenas_Nr ,
'' as Occupation_Cd ,
'' as Organization_Unit_Cd ,
'' as Party_Curr_Annual_Income_Vl ,
'NON_PGIM' as Risk_Segment_Cd ,
e.cd_uf as Region_Cd ,
convert(date,getdate()) as Row_Update_Dt ,
p.nm_setor as Sector_Cd ,
'' as Is_Our_Employee_Ds ,
'' as Is_Psp_Ds ,
'' as Is_Tppp_Ds ,
'' as Is_Foreign_Corporation_Nm ,
'' as Primary_Representative_Key_Id ,
'' as Source_Of_Income_Cd ,
'' as Party_Status_Cd ,
'' as Non_Res_Alien_Cd ,
'' as Number_Of_Dependents_Nr ,
'' as Tax_Bracket_Cd ,
'' as Behaviour_Trends_Nm ,
'' as Client_Level_Opening_Ch_Ds ,
'' as Percentage_Pc ,
'' as Employee_Type_Cd ,
'I4Pro' as Source_System_Cd ,
'' as Relation_Type_Cd ,
'' as Custom_Role_Ds ,
a.Cd_Apolice as Custom_Policy_Number_Nr 

FROM corp_pessoas p 
join corp_sub_estipulante sub on p.id_pessoa = sub.Id_pessoa_sub
join Corp_Apolice a ON a.Id_apolice = sub.Id_apolice 
join corp_sexo s on p.id_sexo = s.id_sexo 
inner join corp_tp_pessoa tpp on p.Cd_tipo_pessoa = tpp.Cd_tipo_pessoa

left join   
(
SELECT Id_pessoa, id_tp_endereco, nm_endereco, nm_cidade, nm_cep, cd_uf,
RANK() OVER   (PARTITION BY Id_pessoa  ORDER BY id_endereco,  nr_sequencia ASC ) AS Rank 
FROM i4Pro_Teste.dbo.corp_endereco  where nr_sequencia= 1
) as e on  p.id_pessoa = e.Id_pessoa and e.rank= 1